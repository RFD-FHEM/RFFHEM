defmod test_mu_1 UnitTest dummyDuino (
 {
	use Test2::V0;
	use Test2::Tools::Compare qw{ is isnt };

  	my $mock = Mock::Sub->new;
	my $SD_Dispatch = $mock->mock("SIGNALduno_Dispatch");
	
    my %local_ProtocolListSIGNALduino =  SIGNALduino_LoadProtocolHash("$attr{global}{modpath}/FHEM/lib/test_loadprotohash-ok.pm");
    my $ProtocolListSIGNALduino_REF = SIGNALduino_getProtocolList();
    
    %$ProtocolListSIGNALduino_REF = %local_ProtocolListSIGNALduino;
    foreach my $pID (keys %local_ProtocolListSIGNALduino)
	{
		next if (!exists($local_ProtocolListSIGNALduino{$pID}{test_data}{$name}));
    	foreach my $testData (values @{$local_ProtocolListSIGNALduino{$pID}{test_data}{$name}}) 
        {
          subtest "$testData->{desc}" => sub {
              SIGNALduino_IdList("sduino_IdList:$target",$pID);
              $SD_Dispatch->reset();
              my $rmsg=$testData->{input};

              plan(scalar @{$testData->{output}});
              my %signal_parts=SIGNALduino_Split_Message($rmsg,$targetHash->{NAME});
              is(SIGNALduino_Parse_MU($targetHash, $targetHash, $targetHash->{NAME}, $rmsg, %signal_parts),$testData->{output}[0] ,"check return code SIGNALduino_Parse_MU") if (defined($testData->{output}[0]));
              is($SD_Dispatch->called_count, $testData->{output}[1], "check number of dispatch attempts") if (defined($testData->{output}[1]));
              is( ($SD_Dispatch->called_with)[4], $testData->{output}[2], "SIGNALduno_Dispatch check id " ) if (defined($testData->{output}[2]));
              is( ($SD_Dispatch->called_with)[2], $testData->{output}[3], "SIGNALduno_Dispatch check dmsg" ) if (defined($testData->{output}[3]));
          };
        }
    };
	$SD_Dispatch->unmock();
	undef %{$ProtocolListSIGNALduino_REF};
	
	%{$ProtocolListSIGNALduino_REF} = SIGNALduino_LoadProtocolHash("$attr{global}{modpath}/FHEM/lib/SD_ProtocolData.pm");
	
	SIGNALduino_IdList("x:$target","","","");  
	foreach my $id (qw/9999 9998 9997 9996/)
	{
		isnt($ProtocolListSIGNALduino_REF->{$id}{id},$id,"check if id $id is deleted");
	}
 }
);

